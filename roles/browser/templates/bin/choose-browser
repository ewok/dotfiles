#!/bin/env bash

BROWSERS=""

if [[ -x {{ conf.folders.bin }}/qutebrowser ]]; then
    BROWSERS+="qutebrowser-default|qutebrowser-work|"
fi

if [[ -x {{ conf.folders.bin }}/vieb ]]; then
    BROWSERS+="vieb-home|vieb-work|"
fi

if [[ -x {{ conf.folders.bin }}/google-chrome-stable ]]; then
    BROWSERS+="google-chrome-stable|"
fi

if command -v chromium &>/dev/null; then
    BROWSERS+="chromium|"
fi

if command -v firefox &>/dev/null; then
    BROWSERS+="firefox|"
fi

CMD=$(echo "${BROWSERS}log" | {{ conf.folders.bin }}/rofi_run -dmenu -i -l 20 -p "Open url in:" -sep "|")

case $CMD in
    qutebrowser-default)
        {{ conf.folders.bin }}/qutebrowser --target tab-bg-silent "$1"
        ;;
    qutebrowser-work)
        SESSION_NAME=work {{ conf.folders.bin }}/qutebrowser -r work --target tab-bg-silent "$1"
        ;;
    vieb-home)
        coproc vieb "$1"
        ;;
    vieb-work)
        coproc vieb-work "$1"
        ;;
    chromium)
        chromium "$1"
        ;;
    google-chrome-stable)
        google-chrome-stable "$1"
        ;;
    firefox)
        firefox "$1"
        ;;
    log)
        echo "$@" >> ~/tmp/.browser-log
        ;;
esac
